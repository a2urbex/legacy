{% extends '@EasyAdmin/page/content.html.twig' %}
{% block title %}a2urbex!{% endblock %}
{% block content %}

<header>
	<h1>Hey {{app.user.firstname}}!</h1>
	<p>
		Currently <b>{{location_count}}</b>	pins, located in <b>{{country_count}}</b> country and sorted in <b>{{type_count}}</b> categories
	</p>
</header>

<section>
	<div class="left">
		<div class="line">
			<div class="highlight">
				<p>Current time :</p>
				<div>{{current_time}}</div>
			</div>
			<div class="highlight">
				<p>Last updated :</p>
				<div>{{pinterest.update_date}}</div>
			</div>
		</div>

		<div class="line">
			<div class="highlight">
				<p>Last fetched :</p>
				<div>{{pinterest.fetch_date}}</div>
			</div>
		</div>

		<div class="line">
			<button class="btn btn-success" id="fetch-pinterest">Fetch Pinterest</button>
			<a class="btn btn-success" href="{{ path('app_fetch_wikimapia') }}">Fetch Wikimapia</a>
			<a class="btn btn-warning" href="{{ path('app_fetch_wikimapia_pending') }}">Fetch Pending</a>
		</div>

		<div class="line">
			<a class="btn btn-primary" href="{{ path('app_update') }}">Update</a>
			<a class="btn btn-warning" href="{{ path('app_patch') }}">Patch</a>
		</div>

		<div class="line">
			<p>Wikimapia progress : x:{{wikimapia.x}} y:{{wikimapia.y}} ({{pending_count}})</p>
		</div>

		<div class="line">
			<div class="progress-bar-wrapper">
				<p class="progress-percent">Waiting...</p>
				<div class="progress-bar">
					<div class="progress-bar-thumb"></div>
				</div>
			</div>
		</div>
	</div>
		
	<div class="right">
		<div class="line sm">
			<p>Output :</p>
		</div>

		<div class="line">
			<div class="output">
				<p>
					BoardId = {{pinterest.board}}<br>
					Status = {{pinterest.status}}<br>
					Error =	{{pinterest.error}}<br>
					Total Parsed = {{pinterest.total_pins}}<br>
					NewPins = {{pinterest.new_pins}}<br>
					---------
				</p>
				Key = {{pinterest.token}}
			</div>
		</div>
		
		<div class="line">
			<a href="{{ path('app_check_count') }}" class="btn btn-secondary">Check</a>
			<p>Waiting to be imported : {{pinterest.pin_to_import}}</p>
		</div>
	</div>
</section>

<section>
	<div class="left center">
		<div class="line sm">
			<p>General Chat :</p>
		</div>

		<div class="line">
			<input type="text" id="message" placeholder="Server Restart.." />
			<button class="btn btn-primary" id="message_admin">Send</button>
			<a class="btn btn-danger" href="{{ path('clear_chat')}}">Clear Chat</a>
		</div>
	</div>

	<div class="right">
		<div class="line sm">
			<p>Server Status :</p>
		</div>

		<div class="line">
			<p class="status offline" data-offline="Currently Offline.." data-online="Online running on :">Currently Offline..</p>
			<div class="output">{{ websocket }}</div>
		</div>
	</div>
</section>

<section>
	<div class="left">
		<div class="line sm">
			<p>Import File :</p>
		</div>

		<div class="line">
			<a class="btn btn-success" href="{{ path('upload')}}">Import File</a>
			<a class="btn btn-primary run-target" href="#">Run</a>
			<a class="btn btn-danger delete-target" href="#">Delete</a>
		</div>
	</div>

	<div class="right">
		<div class="line sm">
			<p>Sources ({{upload_count}}) :</p>
		</div>

		<div class="line">
			<select class="output uploads">
				{% for item in uploads %}
					<option value="{{item.id}}">{{item.Name}}</option>
				{% endfor %}
			</select>
		</div>
	</div>
</section>

<section>
	<div class="left">
		<div class="line sm">
			<p>Ai Generation ({{ai_wainting_count}} locations are waiting to be processed):<br></p>
		</div>

		<div class="line">
			<div class="highlight"><div>{{ai_count}} locations already generated</div></div>
		</div>

		<div class="line">
			<a class="btn btn-success{% if ai_status == false %} off{% endif %}" href="{{ path('app_image_generation')}}">Generate</a>
			<a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui" class="btn btn-secondary"	target="_blank">Documentation</a>
		</div>
	</div>

	<div class="right">
		<div class="line sm">
			<p>Server Status :</p>
		</div>

		<div class="line">
			{% if ai_status %}
				<p class='status online'>Running on Port : {{ ai_port }}</p>
			{% else %}
				<p class='status offline'>Currently offline..</p>
			{% endif %}
		</div>
	</div>
</section>

<section>
	<div class="left">
		<div class="line sm">
			<p>Cache :<br>
		</div>
		<div class="line">
			<button class="btn btn-danger" id="clear-cache-button">Clear Cache</button>
		</div>
		
	</div>
	<div class="right">
		<div class="line sm">
			<p>Database :</p>
		</div>
		<div class="line">
			<a href="{{ path('download_database') }}" class="btn btn-secondary " style="pointer-events:none;">Download Database</a>
		</div>
	</div>
</section>

<script>
	const websocketUrl = "{{ websocket }}";
</script>
{% endblock %}
